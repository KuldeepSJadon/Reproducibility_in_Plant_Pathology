---
title: "Assigning articles to evaluators"
author: "Adam H Sparks"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

## Creating a sample of articles

Twenty one journals in the discipline of plant pathology were selected by the four authors as being the primary choice for most plant pathologists when publishing manuscripts.

Using the assumption that journals publish an average 10 articles per issue, for a population of ~1000 articles, using a confidence level of 95% and confidence interval of 10% we need 88 samples. In [Issue #3](https://github.com/adamhsparks/Reproducible-Research-in-Plant-Pathology/issues/3), we decided to select 200 articles to have a large sample of the population.

## R setup
Set up the R environment

```{r library, message=FALSE}
library(dplyr)
library(readr)
library(Reproducible.Plant.Pathology)

set.seed(1)

# For printing tibble in total
options(tibble.print_max = 21, tibble.print_min = 21)
```
## Create list of journals

We hand-picked a list of 21 journals that we felt represented plant pathology research. In this step, we will create a `tibble` in R of these journals, assigning them a number so that we can randomise them.

```{r journal_list}
journal_list <- tibble(
  seq(1:21),
  c("Australasian Plant Pathology",
    "Canadian Journal of Plant Pathology",
    "Crop Protection",
    "European Journal of Plant Pathology",
    "Forest Pathology",
    "Journal of General Plant Pathology",
    "Journal of Phytopathology",
    "Journal of Plant Pathology",
    "Virology Journal (Plant Viruses Section)",
    "Molecular Plant-Microbe Interactions",
    "Molecular Plant Pathology",
    "Nematology",
    "Physiological and Molecular Plant Pathology",
    "Phytoparasitica",
    "Phytopathologia Mediterranea",
    "Phytopathology",
    "Plant Disease",
    "Plant Health Progress",
    "Plant Pathology",
    "Revista Mexicana de FitopatologÃ­a",
    "Tropical Plant Pathology"))

names(journal_list) <- c("number", "publication")
```

## Create list of evaluators

From the four authors of this paper, in this step, we will create a list for us to use that will randomly assign articles for us to evaluate for this manuscript.

```{r assignee}
assignee <- rep(c("Adam", "Emerson", "Zach", "Nik"), 50)

```

## Create randomised list

Now we will create a randomised list of journal articles to assign to each of the four authors for this paper.

### Create a randomised list of the journals

```{r journal_sample}
journals <- tibble::tibble(sample(1:21, 200, replace = TRUE))
names(journals) <- "number"
journals <- dplyr::left_join(journals, journal_list, "number")
```

### Randomly select articles

Generate a random list of years between 2012 and 2016 and a random list of start pages between 1 and 150 since some journals start numbering at 1 with every issue. Then bind the columns of the randomised list of journals with the randomised years and page start numbers. This then assumes that there is no temporal effect, _i.e._, the time of year an article is published does not affect whether or not it is reproducible.


```{r years_and_articles}

year <- sample(2012:2016, 200, replace = TRUE)

start_page <- sample.int(150, 200, replace = TRUE)

journals <- cbind(journals[, -1], year, start_page, assignee)

dplyr::arrange(journals, publication, year, start_page)

```

### Check the number of articles per journal

```{r, count}
journals %>%  
  dplyr::group_by(publication) %>% 
  dplyr::tally(sort = TRUE) 
```

Once this is done, the articles are manually examined for suitability. Reference articles or
off-topic articles are not included. Notes are provided regarding these cases in `assigned_article_notes`. If the selected page number/article
was not suitable, the next sequential article was selected manually.

## Generate a bibliography file to use with the paper

Using the DOIs in this file, we can retrieve the BibTex citations for those articles that provide a DOI. Note that not all of the selected articles have a DOI, so we'll have to manually generate those entries, or fetch them from the journals' website later.

```{r join_files, warning=FALSE, message=FALSE, results="hide", eval=FALSE}

notes <- Reproducible.Plant.Pathology::assigned_article_notes
notes$doi <- tolower(notes$doi) # format DOIs to all be uniform, lower-case
notes$journal <- iconv(notes$journal, "latin1", "UTF-8") # convert encodings for text with accents

bib <- lapply(notes$doi, doi2bib) # get bib references from the DOI (that exist)

lapply(bib, write, "~/examined_articles.bib", append = TRUE)

```

## Last steps

The last few steps are completed outside of R, manually add the missing articles
to the `examined_articles.bib` file and put it in the `inst/paper` directory
for use writing the paper.

